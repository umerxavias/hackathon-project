(this["webpackJsonpreact-platformer"]=this["webpackJsonpreact-platformer"]||[]).push([[0],{10:function(t,e,i){"use strict";i.r(e);var s=i(1),a=i.n(s),r=i(3),n=i.n(r);i(8);function h(t,e){return Math.random()*(e-t)+t}function o(t,e){return Math.floor(h(t,e))}class l{constructor(t){this.game=t,this.startX=0,this.startY=0,this.endX=16,this.endY=11,this.mut=[1,1],this.followingObject=null,this.followSpeed=2,this.followX=!0,this.followY=!0,this.minX=null,this.minY=null,this.maxX=null,this.maxY=null,this.shakeTick=0,this.shakeMagnitude=1,this.calculateMultiplier()}shake(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.3,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.shakeTick=t,this.shakeMagnitude=e}update(t){if(this.followingObject){var e=this.followingObject.getCenter(),i=this.getCenter();"number"===typeof this.maxY&&(e[1]=Math.min(this.maxY-this.getHeight()/2,e[1])),"number"===typeof this.minX&&(e[0]=Math.max(this.minX+this.getWidth()/2,e[0]));var s=e[0]-i[0],a=e[1]-i[1];if(Math.abs(s)>.01||Math.abs(a)>.01){var r=[i[0],i[1]],n=function(t,e,i,s){let a=i-t,r=s-e;return Math.sqrt(r*r+a*a)}(e[0],e[1],i[0],i[1])*t*this.followSpeed;function o(t){r[t]<e[t]?r[t]+n<e[t]?r[t]+=n:r[t]=e[t]:r[t]>e[t]&&(r[t]-n>e[t]?r[t]-=n:r[t]=e[t])}Math.abs(s)>.1&&this.followX&&o(0),Math.abs(a)>.1&&this.followY&&o(1),this.shakeTick>0&&(this.shakeTick-=t,r[0]+=h(-1,1)/100*this.shakeMagnitude,r[1]+=h(-1,1)/100*this.shakeMagnitude),this.setPositionCenter(r[0],r[1])}}}updateAspectRatio(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];var e=this.game.getViewport();if(t){var i=this.getHeight(),s=i*(e[0]/e[1]);this.setPositionCenterAndSize(...this.getCenter(),s,i)}else{var a=this.getWidth(),r=a*(e[1]/e[0]);this.setPositionCenterAndSize(...this.getCenter(),a,r)}}scaleSize(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.setPositionCenterAndSize(...this.getCenter(),this.getWidth()*t,this.getHeight()*t)}setPositionCenter(t,e){this.setPositionCenterAndSize(t,e,this.endX-this.startX,this.endY-this.startY)}setPositionCenterAndSize(t,e,i,s){var a=[i,s];this.startX=t-a[0]/2,this.startY=e-a[1]/2,this.endX=t+a[0]/2,this.endY=e+a[1]/2,this.calculateMultiplier()}setSize(t,e){var i=this.getCenter();this.setPositionCenterAndSize(i[0],i[1],t,e)}getCenter(){return[this.startX+this.getWidth()/2,this.startY+this.getHeight()/2]}getWidth(){return this.endX-this.startX}getHeight(){return this.endY-this.startY}calculateMultiplier(){var t=this.game.getViewport();this.mut=[t[0]/this.getWidth(),t[1]/this.getHeight()]}transformX(t){return t*this.mut[0]}transformY(t){return t*this.mut[1]}transformCoordinates(t,e){var i=[t-this.startX,e-this.startY];return i[0]*=this.mut[0],i[1]*=this.mut[1],i}transformRect(t,e,i,s){return[...this.transformCoordinates(t,e),this.transformX(i),this.transformY(s)]}}class m{constructor(t){this.game=t,this.controlling=this.game.player}update(t){var e=(this.controlling.onGround?6:5.5)*t;this.game.inputManager.isKeyDown("shift")&&(e/=5),this.controlling.crouch&&(e/=5);var i=this.game.inputManager.isKeyDown("a")||this.game.inputManager.isKeyDown("ArrowLeft"),s=this.game.inputManager.isKeyDown("d")||this.game.inputManager.isKeyDown("ArrowRight"),a=i^s&&!this.controlling.animation.disableController;a?(i&&(this.controlling.x-=e,this.controlling.facing=0),s&&(this.controlling.x+=e,this.controlling.facing=1),this.controlling.running||(this.controlling.running=!0)):this.controlling.running&&(this.controlling.running=!1);var r=!1;if((this.game.inputManager.isKeyDown("s")||this.game.inputManager.isKeyDown("ArrowDown"))&&(this.controlling.ledgeHang?this.controlling.y+=t:this.controlling.onGround&&(a?this.controlling.crouch?r=!0:this.controlling.slide():r="crouch"===this.controlling.animationName||"crawl"===this.controlling.animationName||this.controlling.animation.idle)),this.controlling.setCrouch(r),(this.game.inputManager.isKeyPressed("w")||this.game.inputManager.isKeyPressed(" ")||this.game.inputManager.isKeyPressed("ArrowUp"))&&(this.controlling.animation.disableController||this.controlling.jump()),this.controlling.animation.disableController||(this.game.inputManager.isMousePressed("0")&&(this.controlling.onGround?this.controlling.attack():this.controlling.groundSlam()),this.game.inputManager.isKeyPressed("f")&&this.controlling.knockback(),this.game.inputManager.isKeyPressed("g")&&(this.game.showInfo=!this.game.showInfo)),this.game.inputManager.isKeyPressed("-")&&this.game.camera.scaleSize(1.1),this.game.inputManager.isKeyPressed("=")&&this.game.camera.scaleSize(.9),this.controlling.x>this.game.levelWidth/5){for(var n=this.game.map,h=[],o=0;o<n.length;o++){var[l,m]=this.game.convertIndexToCoordinates(o);(h[m]||(h[m]=[])).push(n[o])}var c=[];for(o=0;o<h.length;o++)c.push(...h[o],...h[o]);this.game.map=c,this.game.levelWidth*=2,this.game.collisionMap=this.game.createCollisionMap()}}}class c{constructor(t){this.game=t,this.x=0,this.y=0,this.w=0,this.h=0,this.velocityX=0,this.velocityY=0,this.colliding=!1,this.delete=!1}setVelocity(t,e){this.velocityX=t,this.velocityY=e}setLeft(t){this.x=t}getLeft(){return this.x}setRight(t){this.x=t-this.w}getRight(){return this.x+this.w}setTop(t){this.y=t}getTop(){return this.y}setBottom(t){this.y=t-this.h}getBottom(){return this.y+this.h}getCenter(){return[this.x+this.w/2,this.y+this.h/2]}update(t){if(this.velocityX){var e=this.velocityX<0,i=Math.abs(this.velocityX);(a=Math.max(4*i*t,t/2))>i&&(a=i),(i-=a)<0&&(i=0),this.velocityX=e?-i:i;var s=e?-a:a;this.x+=s}if(this.velocityY){var a;e=this.velocityY<0,i=Math.abs(this.velocityY);(a=Math.max(4*i*t,t/2))>i&&(a=i),(i-=a)<0&&(i=0),this.velocityY=e?-i:i;s=e?-a:a;this.y+=s}this.tiles={},this.onGround=!1,this.colliding=!1;for(var r=new Set,n=Math.floor(this.x)-1;n<=Math.floor(this.x+this.w)+1;n+=.4)for(var h=Math.floor(this.y)-1;h<=Math.floor(this.y+this.h)+1;h+=.4){var o=Math.floor(n),l=Math.floor(h),m=this.game.convertCoordinatesToIndex(o,l);this.game.collisionMap[m]&&r.add(m)}var c=null,d=0,p=0,g=null,f=!1;for(var u of Array.from(r)){var y=u,[n,h]=this.game.convertIndexToCoordinates(y),w={x:n,y:h,w:1,h:1};if(this.collidesWith(w)){var v=this.calculateOverlap(w);"top"===v&&(this.crouch||"top"===this.calculateOverlap(w,{x:this.x,y:this.getBottom()-.1,w:this.w,h:.1})||(v=this.x<w.x?"left":"right"));var _={left:1,right:2,top:4,bottom:8}[v];this.game.collisionMap[y]&_&&(this.colliding=!0,"top"===v?(this.onGround=!0,p=h,this.getBottom()>h&&this.setBottom(h+.01)):"bottom"===v?this.getTop()<h+1&&this.setTop(h+1):"left"===v?(c=n-this.w,d=h,g=w,f=1===this.facing):"right"===v&&(c=n+w.w,d=h,g=w,f=0===this.facing),this.tiles[y]=_)}}"number"===typeof c&&p!==d?(this.x=c,!this.onGround&&"crawl"!==this.animationName&&"roll"!==this.animationName&&f&&this.game.collisionMap[this.game.convertCoordinatesToIndex(g.x,g.y-1)]&&(this.y-Math.floor(this.y)<.3||this.game.collisionMap[this.game.convertCoordinatesToIndex(g.x,g.y+1)])&&(this.ledgeHang=!0,"ledge_hang"!==this.animationName&&"wall_jump"!==this.animationName&&this.setAnimation("ledge_hang"))):this.ledgeHang&&(this.ledgeHang=!1,this.setAnimation("fall"))}collidesWith(t,e){var i=e||this,s=t;return i.x<s.x+s.w&&i.x+i.w>s.x&&i.y<s.y+s.h&&i.h+i.y>s.y}calculateOverlap(t,e){var i=e||this,s=t,a=i.x+i.w/2-(s.x+s.w/2),r=i.y+i.h/2-(s.y+s.h/2),n=(i.w+s.w)/2,h=(i.h+s.h)/2,o=n*r,l=h*a,m="none";return Math.abs(a)<=n&&Math.abs(r)<=h&&(m=o>l?o>-l?"bottom":"left":o>-l?"right":"top"),m}}class d extends c{constructor(t){super(t),this.w=.1,this.h=.1,this.direction=-1}render(){this.game.render.drawRect(this.x,this.y,this.w,this.h,"#ff2222")}update(t){this.x+=t*this.direction*3,super.update(),this.collidesWith(this.game.player)&&("attack1"===this.game.player.animationName?(this.direction=0===this.game.player.facing?-1:1,this.game.particleSystem.spawnParticles(this.x,this.y,6,.5),this.game.camera.shake()):"ground_slam"===this.game.player.animationName?(this.colliding=!0,this.game.camera.shake()):(this.game.player.facing=this.direction<0?1:0,this.game.player.knockback(),this.colliding=!0)),this.colliding&&(this.delete=!0,this.game.particleSystem.spawnParticles(this.x,this.y,5,.3))}}class p{constructor(){this.keyboard=Object.create(null),this.keypress=Object.create(null),this.mouse=Object.create(null),this.mousePress=Object.create(null),this.mousePos=[],this.mouseMoved=!0,this.events=[]}addEventListener(t,e){window.addEventListener(t,e),this.events.push([t,e])}start(){this.addEventListener("keydown",(t=>{this.handleKeyEvent(t.key,!0)})),this.addEventListener("keyup",(t=>{this.handleKeyEvent(t.key,!1)})),this.addEventListener("mousedown",(t=>{this.handleMouseEvent(t.button,!0)})),this.addEventListener("mouseup",(t=>{this.handleMouseEvent(t.button,!1)})),this.addEventListener("mousemove",(t=>{this.mousePos=[t.pageX,t.pageY],this.mouseMoved=!0}))}end(){this.events.forEach((t=>{window.removeEventListener(t[0],t[1])})),this.events=[]}getMousePosition(){return this.mousePos}mouseToButton(t){return"left"===t?0:"right"===t?2:parseInt(t)}isMouseMove(){return!!this.mouseMoved&&(this.mouseMoved=!1,!0)}isKeyDown(t){var e=t.toString().toLowerCase();return!!this.keyboard[e]}isKeyPressed(t){var e=t.toString().toLowerCase(),i=this.keypress[e];return i&&(this.keypress[e]=!1),i}isMouseDown(t){return this.mouse[this.mouseToButton(t)]}isMousePressed(t){var e=this.mouseToButton(t),i=this.mousePress[e];return i&&(this.mousePress[e]=!1),i}handleKeyEvent(t,e){var i=t.toString().toLowerCase();e&&this.keyboard[i]||(this.keyboard[i]=e,this.keypress[i]=e)}handleMouseEvent(t,e){this.mouse[t]=e,this.mousePress[t]=e}}class g{constructor(t){this.game=t,this.particles=[]}spawnParticles(t,e){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;for(var a=1===i?i:o(.9*i,1.1*i),r=0;r<a;r++){var n=h(0,2*Math.PI),l=h(.1,6)/100,m=Math.cos(n)*h(3,5)/100,c=Math.sin(n)*h(3,5)/100;this.particles.push({x:t+m,y:e+c,size:h(3,6*s)/100,ticks:h(0,1),vx:Math.cos(n)*l,vy:Math.sin(n)*l,alpha:h(0,.1)})}}render(){for(var t of this.particles)this.game.ctx.globalAlpha=Math.min(1,Math.max(0,t.alpha)),this.game.render.drawRect(t.x,t.y,Math.max(0,t.size),Math.max(0,t.size),"#fff");this.game.ctx.globalAlpha=1}update(t){for(var e=[],i=0;i<this.particles.length;i++){var s=this.particles[i];s.x+=t*s.vx,s.y+=t*s.vy,s.ticks+=t,s.ticks>2?(s.size-=t/200,s.alpha-=t/2,(s.size<1e-4||s.alpha<1e-4)&&e.unshift(i)):s.alpha<1&&(s.alpha+=3*t)}for(i=0;i<e.length;i++)this.particles.splice(e[i],1)}}class f{constructor(t){let{sprite:e,frames:i,speed:s,after:a,xOffset:r,yOffset:n,disableController:h,idle:o,size:l,timeout:m}=t;this.sprite=e,this.frames=i,this.speed=s,this.after=a,this.disableController=!!h,this.xOffset=r||0,this.yOffset=n||0,this.idle=!!o,this.size=l,this.timeout=m}}class u extends c{constructor(t){super(t),this.x=5,this.y=5,this.w=.55,this.h=.95,this.defaultSize=[this.w,this.h],this.onGround=!1,this.running=!1,this.gravityTick=0,this.ledgeHang=!1,this.doubleJumped=!1,this.frictionValue=0,this.facing=0,this.game=t,this.tiles={},this.lastLandY=0,this.animations={idle:new f({sprite:"player_idle",frames:[0,1,2,3,4,5,6],speed:140,after:"idle",idle:!0}),look_up:new f({sprite:"player_look_up",frames:[0,1,2,2,2,2,2,2,2,2,1,0],speed:200,after:"idle",idle:!0}),run:new f({sprite:"player_run",frames:[0,1,2,3,4,5,7],speed:120}),jump:new f({sprite:"player_jump",frames:[0],speed:110,after:"fall"}),fall:new f({sprite:"player_jump",frames:[1,2],speed:250,after:"fall"}),land:new f({sprite:"player_land",frames:[0,1],speed:100,after:"idle",idle:!0}),slide:new f({sprite:"player_slide",frames:[0,1,2],speed:90,after:"slide_transition",disableController:!1,size:[1,.6],yOffset:-.4,xOffset:[.3,.2],timeout:!1}),slide_transition:new f({sprite:"player_slide",frames:[3],speed:100,after:"idle",idle:!0}),roll:new f({sprite:"player_front_flip",frames:[5,6,7,8,9,10,11,12],speed:60,after:"fall",size:[.55,.6],yOffset:-.15}),attack1:new f({sprite:"player_combat_combo_01_attack_01",frames:[0,1,2,3,4,5],speed:100,after:"idle",disableController:!0}),attack2:new f({sprite:"player_combat_combo_01_attack_02",frames:[0,1,2,3,4],speed:100,after:"idle",disableController:!0}),attack3:new f({sprite:"player_combat_combo_01_attack_03",frames:[0,1,2,3],speed:100,after:"idle",disableController:!0}),attack4:new f({sprite:"player_combat_combo_01_attack_04",frames:[0,1,2,3,4,5,6,7,8],speed:100,after:"idle",disableController:!0}),ground_slam:new f({sprite:"player_combat_ground_slam",frames:[0,1,2,3,4,5,6],speed:100,after:"ground_slam_transition",disableController:!0}),ground_slam_transition:new f({sprite:"player_combat_ground_slam",frames:[7,8,9],speed:100,after:"idle",idle:!0}),knockback:new f({sprite:"player_knockback",frames:[0,1,2,4,4,4,4,4,4,4,5],speed:100,after:"idle",disableController:!0}),ledge_climb:new f({sprite:"player_ledge_climb",frames:[0,1,2,3,4,5,6,7],speed:100,after:"ledge_climb",xOffset:[.3,-.3],yOffset:.9}),ledge_hang:new f({sprite:"player_ledge_hang",frames:[0,1,2,3,4,5],speed:100,after:"ledge_hang",xOffset:[-.1,.11]}),wall_jump:new f({sprite:"player_wall_jump",frames:[0,1,2,3,4,5,6,7,8,9,10],speed:100,after:"fall"}),crouch:new f({sprite:"player_crouch",frames:[0,1,2,3,4,5],speed:100,after:"crouch",size:[.55,.6],yOffset:-.4}),crawl:new f({sprite:"player_crawl",frames:[0,1,2,3,4,5,6,7],speed:120,after:"crawl",size:[.55,.6],yOffset:-.4})},this.animation=null,this.animationName="",this.setAnimation("idle"),this.crouch=!1}setCrouch(t){!this.crouch&&t?(this.setAnimation("crouch"),this.crouch=!0):this.crouch&&!t&&(this.crouch=!1,this.setAnimation("idle"))}setAnimation(t){let e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!this.animations[t])throw new Error("Invalid animation: "+t);"crouch"!==t&&"crawl"!==t&&this.setCrouch(!1);var i=this.animation;this.animation=this.animations[t],this.animationName=t,this.animationTick=0,this.animation.size?(this.w=this.animation.size[0],this.h=this.animation.size[1],this.x+=(this.defaultSize[0]-this.animation.size[0])/2,this.y+=this.defaultSize[1]-this.animation.size[1]):([this.w,this.h]=this.defaultSize,e&&i&&i.size&&(this.x-=(this.w-i.size[0])/2,this.y-=this.h-i.size[1]))}attack(){this.game.camera.shake(.15,.8),this.setAnimation("attack1")}groundSlam(){this.setAnimation("ground_slam")}jump(){this.doubleJumped&&!this.ledgeHang||(this.gravityTick=0,this.velocityX=0,this.lastLandY=null,this.game.particleSystem.spawnParticles(this.getCenter()[0],this.getBottom()-.1,4,.3),this.onGround?(this.setAnimation("jump"),this.velocityY=-5):(this.setAnimation("roll"),this.ledgeHang=!1,this.doubleJumped=!0,this.velocityY=-4.85))}slide(){this.animations.slide.timeout||(this.animations.slide.timeout=!0,setTimeout((()=>{this.animations.slide.timeout=!1}),1500),this.setAnimation("slide"))}knockback(){this.setAnimation("knockback"),setTimeout((()=>{this.velocityX=.1*(0==this.facing?1:-1)}),100)}render(t){this.animationTick+=1e3*t;var e=Math.floor(this.animationTick/this.animation.speed),i=!1;e>this.animation.frames.length-1&&(e>this.animation.frames.length&&(i=!0),e=this.animation.frames.length-1);var s=this.animation.frames[e];this.game.showInfo&&this.game.render.drawRect(this.x,this.y,this.w,this.h,this.onGround?"#444":"#663333");var[a,r]=this.defaultSize;this.game.render.drawSprite({sprite:this.animation.sprite,frame:s,effects:0==this.facing?["flipHorizontally"]:[]},this.x-1.55*a+(Array.isArray(this.animation.xOffset)?this.animation.xOffset[this.facing]:this.animation.xOffset)+0,this.y-1.05*r+this.animation.yOffset,a*r*4.3,a*r*4.3*.875),i&&(this.animation.after?"idle"===this.animationName&&Math.random()>.5?this.setAnimation("look_up"):this.setAnimation(this.animation.after):this.setAnimation(this.animationName)),this.running?(this.animation.idle&&this.setAnimation("run"),"crouch"===this.animationName&&this.setAnimation("crawl")):("run"===this.animationName&&this.setAnimation("idle"),"crawl"===this.animationName&&this.setAnimation("crouch")),this.onGround?"fall"===this.animationName&&this.setAnimation("idle"):(this.animation.idle||!this.ledgeHang&&"ledge_hang"===this.animationName)&&this.setAnimation("fall")}update(t){var e=this.onGround;if(super.update(t),this.onGround||this.ledgeHang?this.gravityTick=0:(this.gravityTick+=t,this.y+=Math.min(this.gravityTick/5,10*t)),this.animationName.includes("slide")?(this.velocityX=Math.sqrt(-.07*this.frictionValue+3)*(0==this.facing?-1:1),this.frictionValue++):this.frictionValue=0,this.onGround&&(this.doubleJumped=!1,!e)){var i=Math.floor(this.y);i!==this.lastLandY&&(this.lastLandY=i,this.game.particleSystem.spawnParticles(this.getCenter()[0],this.getBottom()-.1,5,.3),this.velocityY<0&&(this.velocityY=0),"ground_slam"!==this.animationName&&"knockback"!==this.animationName?this.setAnimation("land",!0):this.game.camera.shake(.1,4))}this.x=Math.max(0,Math.min(this.game.levelWidth-this.w,this.x)),this.y=Math.max(0,Math.min(this.game.levelHeight-this.h,this.y))}}class y{constructor(t){this.game=t}setAlpha(t){this.game.ctx.globalAlpha=t}drawLine(t,e,i,s,a,r){this.game.ctx.strokeStyle=r,this.game.ctx.beginPath(),this.game.ctx.moveTo(...this.game.camera.transformCoordinates(t,e)),this.game.ctx.lineTo(...this.game.camera.transformCoordinates(i,s)),this.game.ctx.lineWidth=this.game.camera.transformX(a),this.game.ctx.stroke(),this.game.ctx.closePath()}drawRect(t,e,i,s,a){this.game.ctx.fillStyle=a,this.game.ctx.fillRect(...this.game.camera.transformRect(t,e,i,s))}drawCircle(t,e,i,s){this.game.ctx.fillStyle=s,this.game.ctx.beginPath(),this.game.ctx.arc(...this.game.camera.transformCoordinates(t,e),this.game.camera.transformX(i),2*Math.PI,0),this.game.ctx.fill(),this.game.ctx.closePath()}drawSprite(t,e,i,s,a){var r=this.game.ssm.getSpriteFromInfoObject(t);if(r){this.drawScalingSprite(t,e,i,s,a);var n=r.h/r.w,h=a/s;if(n.toFixed(2)!==h.toFixed(2))throw new Error("Invalid aspect ratio while drawing "+JSON.stringify(t)+", expected: "+n+", received: "+h)}}drawScalingSprite(t,e,i,s,a){var r=this.game.ssm.getSpriteFromInfoObject(t);r&&this.drawImage(r.spriteSheet.image,e,i,s,a,r.x,r.y,r.w,r.h)}drawImage(t,e,i,s,a,r,n,h,o){this.game.ctx.drawImage(t,r,n,h,o,...this.game.camera.transformRect(e,i,s,a).map(Math.round))}drawImageWithRotation(t,e,i,s,a,r,n,h,o,l){var[m,c,d,p]=this.game.camera.transformRect(e,i,s,a);m+=d/2,c+=p/2;var g=this.game.ctx,f=l*(Math.PI/180);g.translate(m,c),g.rotate(f),g.drawImage(t,r,n,h,o,-d/2,-p/2,d,p),g.rotate(-f),g.translate(-m,-c)}drawText(t,e,i,s,a){this.game.ctx.fillStyle=a,this.game.ctx.font=s+"px",this.game.ctx.fillText(t,...this.game.camera.transformCoordinates(e,i))}drawScalingText(t,e,i,s,a,r){this.game.ctx.fillStyle=r,this.game.ctx.font=a+"px",this.game.ctx.fillText(t,...this.game.camera.transformCoordinates(e,i),this.game.camera.transformX(s))}}class w{constructor(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}async applyEffectsToSpriteSheet(t,e){if(!e.length)return t;var i,s=new Map,a={};for(var r in t.sprites){var n=(d=t.sprites[r]).spriteSheet.image,h=new _(d,d.spriteSheet);a[r]=h,i||(i=n),s.has(n)?s.get(n).push(h):s.set(n,[h])}var o=new v(await this.applyEffectsToImage(i,e),{type:"manual",sprites:{}},t.ssm,!1);for(var n of(o.sprites=a,s.keys())){var l=s.get(n),m=await this.applyEffectsToImage(n,e),c=new v(m,{type:"manual",sprites:{}},t.ssm,!1);for(var d of(c.sprites=l,l))d.spriteSheet=c}return o}async applyEffectsToImage(t,e){if(!e.length)return t;var i=t;for(var s of e)i=await this.applyEffectToImage(i,s);return i}async applyEffectToImage(t,e){return new Promise(((i,s)=>{var a="string"===typeof e?e:e.name;switch(this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),a){case"flipHorizontally":this.flipHorizontally(t);break;case"teamColor":this.teamColor(t,e.payload);break;default:throw new Error("Invalid effect name "+a)}let r=new Image;var n=this.canvas.toDataURL("image/png");r.src=n,r.onload=()=>{r.loaded=!0,i(r)}}))}teamColor(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"#ff2222";var i=this.ctx,s=this.canvas;Array.isArray(e)&&(e="rgb("+e.join(",")+")"),this.canvas.width=t.width,this.canvas.height=t.height,i.drawImage(t,0,0),i.globalCompositeOperation="darken",i.fillStyle=e,i.fillRect(0,0,s.width,s.height),i.globalAlpha=1,i.globalCompositeOperation="destination-in",i.drawImage(t,0,0)}flipHorizontally(t){this.canvas.width=t.width,this.canvas.height=t.height;((t,e,i)=>{this.ctx.translate(e+t.width,i),this.ctx.scale(-1,1),this.ctx.drawImage(t,0,0),this.ctx.setTransform(1,0,0,1,0,0)})(t,0,0)}}class v{constructor(t,e,i){let s=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(!i||!(i instanceof x))throw new Error("Invalid spriteSheetManager");this.sprites={},this.ssm=i,this.effectsCache={},this.creating={},this.name="",this.image=t instanceof Image?t:new Image,"string"===typeof t&&(this.image.src="./sprites/"+t),this.image.addEventListener("error",(t=>{console.log("Error loading "+this.image.src,t)})),this.image.addEventListener("load",(()=>{if(this.image.loaded=!0,s&&this.ssm.incrementLoaded(),"auto"===e.type){if(!e.width||!e.height)throw new Error("Invalid width/height on info "+JSON.stringify(e));var i=e.width,a=e.height,r=e.border||0,n=this.image.width-2*r,h=this.image.height-2*r;if(i>n)throw new Error(t+" invalid sprite width "+i+" when image is "+n+"px wide");if(a>h)throw new Error(t+" invalid sprite height "+i+" when image is "+h+"px tall");for(var o=0,l=0,m=0;this.sprites[m]=new _({x:o,y:l,w:i,h:a},this),m++,(o+=i)>=n&&(o=r,l+=a),!(l>=h););}else if("manual"===e.type){if(!e.sprites)throw new Error("Invalid sprites on info "+JSON.stringify(e));var c=e.sprites;for(var d in c)this.sprites[d]=new _(c[d],this)}else if("increment_file_name"===e.type){var p=t.split("1.png")[0];if(!t.includes("1.png"))throw new Error("Invalid path");this.sprites[0]=new _({x:0,y:0,w:this.image.width,h:this.image.height},this);for(m=2;m<=e.max;m++)(t=>{var e=p+t+".png",i=new _({x:0,y:0,w:this.image.width,h:this.image.height},new v(e,{type:"single"},this.ssm));i.indirect=!0,this.sprites[t-1]=i})(m)}else"single"===e.type&&(this.sprites={0:new _({x:0,y:0,w:this.image.width,h:this.image.height},this)})}))}getSprite(t){var e=this.sprites[t];if(!e)throw new Error("Invalid sprite: "+t+" ("+this.name+") ["+Object.keys(this.sprites).join(",")+"]");return e}getEffects(t){if(!t.length)return this;var e=JSON.stringify(t);return this.effectsCache[e]?this.effectsCache[e]:(this.creating[e]||(this.creating[e]=!0,(async()=>{var i=new w,s=await i.applyEffectsToSpriteSheet(this,t);if(!(s instanceof v))throw new Error("Expected SpriteSheet");this.effectsCache[e]=s,this.creating[e]=!1})()),this)}}class _{constructor(t,e){if(!(e instanceof v))throw new Error("Invalid sprite sheet");this.x=t.x||0,this.y=t.y||0,this.w=t.w||0,this.h=t.h||0,this.spriteSheet=e}}class x{constructor(){this.spriteSheets={},this.assetsLoaded=0,this.assetsTotal=0,this.hasLoaded=!1,this.onLoaded=()=>{}}incrementLoaded(){this.assetsLoaded++,console.log(this.assetsLoaded,this.assetsTotal),setTimeout((()=>{this.assetsLoaded===this.assetsTotal&&(this.hasLoaded||(this.hasLoaded=!0,this.onLoaded()))}),90)}addSpriteSheet(t,e,i){var s=new v(e,i,this);return s.name=t,"increment_file_name"===i.type?this.assetsTotal+=i.max:this.assetsTotal+=1,this.spriteSheets[t]=s,s}getSpriteSheet(t){if(!this.spriteSheets[t])throw new Error("Invalid sprite sheet: "+t);return this.spriteSheets[t]}getSprite(t){var e=t.split(":")[0],i=t.split(":")[1];return this.getSpriteSheet(e).getSprite(i)}getSpriteFromInfoObject(t){var e=t.sprite,i=t.frame,s=t.effects||[],a=this.getSpriteSheet(e).getEffects(s);if(a)return a.getSprite(i);throw new Error("No sprite sheet")}}var b=i(12);class k{constructor(t,e,i){this.canvas=t,this.ctx=e,this.ssm=i,this.render=new y(this),this.camera=new l(this),this.inputManager=new p,this.particleSystem=new g(this),this.player=new u(this),this.controller=new m(this),this.entities={};const s=[[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,5,5,0,0,0,0,0,0,0,0,0,0],[0,5,0,5,0,0,0,0,5,5,5,5,0,0,0],[0,5,0,5,0,0,0,0,0,0,0,5,0,0,0],[0,5,0,5,0,5,5,0,0,0,0,5,0,0,0],[0,5,0,0,0,5,0,0,0,0,0,5,0,0,0],[0,5,5,5,5,5,0,0,5,5,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,5,5,0,0],[0,0,0,5,5,5,5,0,0,0,0,0,5,5,0],[0,0,0,0,5,5,0,0,0,0,0,0,0,5,5],[0,0,0,0,0,5,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,5,0,0,0,0,5,5,5,5,0,0,0,0,0],[5,5,5,0,0,0,0,0,0,5,5,0,0,0,0],[0,5,0,0,0,0,0,0,0,0,5,5,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,5,5,5,5,5,0,5,5,5,5,5],[5,5,5,0,0,0,5,5,0,0,0,5,5,5,5],[5,5,5,0,0,0,0,0,0,0,0,0,5,5,5],[5,5,5,5,5,0,0,0,0,0,0,0,5,5,5],[5,5,5,5,5,0,0,0,0,0,0,5,5,5,5],[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]];if(this.showInfo=!1,this.map=s.flat(1),this.levelWidth=s[0].length,this.levelHeight=s.length,this.camera.endY=this.levelHeight-7,this.camera.startY=this.levelHeight-15,this.camera.maxY=this.levelHeight,this.camera.minX=0,this.player.y=this.levelHeight-12,this.spawnTick=0,this.fpsTick=0,this.fps=0,this.map.length!==this.levelWidth*this.levelHeight)throw new Error("Invalid map length: "+this.map.length);this.collisionMap=this.createCollisionMap()}end(){this.inputManager.end()}spawnEntity(){var t=Object(b.a)(),e=new d(this);this.entities[t]=e;var i=Math.random()>.5?-1:1;this.camera.startX<=0&&(i=1),e.x=-1===i?this.camera.endX+2:this.camera.startX-2,e.direction=i,e.y=this.player.y+o(-2,2)}createCollisionMap(){for(var t=[],e=0;e<this.map.length;e++){var i=0;if(this.map[e]){var[s,a]=this.convertIndexToCoordinates(e),r=this.map[this.convertCoordinatesToIndex(s,a-1)],n=this.map[this.convertCoordinatesToIndex(s,a+1)],h=this.map[this.convertCoordinatesToIndex(s-1,a)],o=this.map[this.convertCoordinatesToIndex(s+1,a)];0!==s&&(i|=h?0:1),s!==this.levelWidth-1&&(i|=o?0:2),0!==a&&(i|=r?0:4),a!==this.levelHeight-1&&(i|=n?0:8)}t.push(i)}return t}getViewport(){return[this.canvas.width,this.canvas.height]}start(){this.inputManager.start(),this.particleSystem.particles=[],this.camera.followingObject=this.player}convertIndexToCoordinates(t){return[t%this.levelWidth,Math.floor(t/this.levelWidth)]}convertCoordinatesToIndex(t,e){return e*this.levelWidth+t}renderGame(t){for(var e in this.ctx.fillStyle="#fff",this.ctx.font="20px Readex Pro",this.ctx.fillText(this.fps+"",5,20),this.ctx.font="14px Readex Pro",this.player.render(t),this.entities){this.entities[e].render(t)}for(var i=0;i<this.map.length;i++){var s=this.collisionMap[i],[a,r]=this.convertIndexToCoordinates(i);if(a+1>this.camera.startX&&r+1>this.camera.startY&&a<=this.camera.endX&&r<=this.camera.endY){var n="#fff",h=.025;1&s&&(this.render.drawRect(a,r,h,1,n),this.render.drawText("1",a+.1,r+.53,14)),2&s&&(this.render.drawRect(a+.975,r,h,1,n),this.render.drawText("2",a+.82,r+.53,14)),4&s&&(this.render.drawRect(a,r,1,h,n),this.render.drawText("4",a+.49,r+.2,14)),8&s&&(this.render.drawRect(a,r+.975,1,h,n),this.render.drawText("8",a+.49,r+.92,14))}}var o=Object.keys(this.player.tiles);for(i=0;i<o.length;i++){var l=o[i],[a,r]=(s=this.player.tiles[l],this.convertIndexToCoordinates(l));1&s&&this.render.drawRect(a,r,.05,1,"#fff"),2&s&&this.render.drawRect(a+.95,r,.05,1,"#fff"),4&s&&this.render.drawRect(a,r,1,.05,"#fff"),8&s&&this.render.drawRect(a,r+.95,1,.05,"#fff")}this.particleSystem.render()}updateGame(t){this.fpsTick+=t,this.fpsTick>.5&&(this.fpsTick=0,this.fps=Math.floor(1/t)),this.spawnTick+=t,this.spawnTick>2&&(this.spawnTick=0,this.spawnEntity()),this.controller.update(t);var e=[];for(var i in this.entities){var s=this.entities[i];s.update(t),s.delete&&e.push(i)}for(var i of e)delete this.entities[i];this.player.update(t),this.particleSystem.update(t),this.camera.update(t)}}var M={player_idle:{type:"increment_file_name",imgPath:"pixel_platformer_player/idle/1.png",max:7},player_run:{type:"increment_file_name",imgPath:"pixel_platformer_player/run/1.png",max:8},player_jump:{type:"increment_file_name",imgPath:"pixel_platformer_player/jump/1.png",max:3},player_land:{type:"increment_file_name",imgPath:"pixel_platformer_player/land/1.png",max:2},player_slide:{type:"increment_file_name",imgPath:"pixel_platformer_player/slide/1.png",max:4},player_roll:{type:"increment_file_name",imgPath:"pixel_platformer_player/roll/1.png",max:10},player_combat_combo_01_attack_01:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_01/1.png",max:6},player_combat_combo_01_attack_02:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_02/1.png",max:5},player_combat_combo_01_attack_03:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_03/1.png",max:4},player_combat_combo_01_attack_04:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_combo_01_attack_04/1.png",max:9},player_combat_ground_slam:{type:"increment_file_name",imgPath:"pixel_platformer_player/combat_ground_slam/1.png",max:10},player_look_up:{type:"increment_file_name",imgPath:"pixel_platformer_player/look_up/1.png",max:3},player_knockback:{type:"increment_file_name",imgPath:"pixel_platformer_player/knockback/1.png",max:6},player_ledge_climb:{type:"increment_file_name",imgPath:"pixel_platformer_player/ledge_climb/1.png",max:8},player_ledge_hang:{type:"increment_file_name",imgPath:"pixel_platformer_player/ledge_hang/1.png",max:6},player_wall_jump:{type:"increment_file_name",imgPath:"pixel_platformer_player/wall_jump/1.png",max:11},player_wall_slide:{type:"increment_file_name",imgPath:"pixel_platformer_player/wall_slide/1.png",max:6},player_crouch:{type:"increment_file_name",imgPath:"pixel_platformer_player/crouch/1.png",max:6},player_crawl:{type:"increment_file_name",imgPath:"pixel_platformer_player/crawl/1.png",max:8},player_front_flip:{type:"increment_file_name",imgPath:"pixel_platformer_player/front_flip/1.png",max:14}},S=i(0);var C=function(){var t=Object(s.useRef)(),[e,i]=Object(s.useState)(!1),a=Object(s.useRef)();return Object(s.useEffect)((()=>{var e=new x;Object.keys(M).forEach((t=>{var i=M[t];e.addSpriteSheet(t,i.imgPath,i)}));var i=t.current;if(i){var s=i.getContext("2d"),r=performance.now(),n=new k(i,s,e);a.current=n,window.game=n;var h=()=>{i.width=window.innerWidth,i.height=window.innerHeight,i.style.width=window.innerWidth+"px",i.style.height=window.innerHeight+"px",n.camera.updateAspectRatio()};h();var o=!0;return n.active=!0,e.onLoaded=()=>{Object.keys(e.spriteSheets).forEach((t=>{t.includes("player_")&&e.spriteSheets[t].getEffects(["flipHorizontally"])})),l(),setTimeout((()=>{n.start()}),100)},window.addEventListener("resize",h),()=>{cancelAnimationFrame(l),window.removeEventListener("resize",h),o=!1,n.end()}}function l(){var t=performance.now(),e=(t-r)/1e3;r=t,e>.25&&(e=.25),s.fillStyle="#000",s.fillRect(0,0,i.width,i.height),n.active&&n.updateGame(e),n.renderGame(e),o&&requestAnimationFrame(l)}}),[]),Object(S.jsxs)("div",{className:e?"":"hide-cursor",children:[Object(S.jsxs)("div",{className:"main-menu"+(e?" main-menu-show":""),children:[Object(S.jsx)("h1",{children:"Platformer"}),Object(S.jsx)("p",{children:"by: MichaelXF"}),Object(S.jsx)("button",{className:"main-btn",onClick:()=>{i(!1)},children:"Play"})]}),Object(S.jsx)("canvas",{ref:t}),Object(S.jsxs)("div",{className:"controls",children:[Object(S.jsx)("kbd",{children:"W"}),Object(S.jsx)("kbd",{children:"A"}),Object(S.jsx)("kbd",{children:"S"}),Object(S.jsx)("kbd",{children:"D"})]})]})};var T=t=>{t&&t instanceof Function&&i.e(3).then(i.bind(null,13)).then((e=>{let{getCLS:i,getFID:s,getFCP:a,getLCP:r,getTTFB:n}=e;i(t),s(t),a(t),r(t),n(t)}))};n.a.render(Object(S.jsx)(a.a.StrictMode,{children:Object(S.jsx)(C,{})}),document.getElementById("root")),T()},8:function(t,e,i){}},[[10,1,2]]]);
//# sourceMappingURL=main.24eef3bd.chunk.js.map